<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.share.user.mapper.UserInfoMapper">

    <resultMap type="com.share.user.domain.UserInfo" id="UserInfoResult">
        <result property="id" column="id"/>
        <result property="wxOpenId" column="wx_open_id"/>
        <result property="nickname" column="nickname"/>
        <result property="gender" column="gender"/>
        <result property="avatarUrl" column="avatar_url"/>
        <result property="phone" column="phone"/>
        <result property="lastLoginIp" column="last_login_ip"/>
        <result property="lastLoginTime" column="last_login_time"/>
        <result property="depositStatus" column="deposit_status"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="selectUserInfoVo">
        select id, wx_open_id, nickname, gender, avatar_url, phone, last_login_ip, last_login_time, deposit_status, status, create_time, update_time
        from user_info
    </sql>

    <select id="selectUserInfoList" parameterType="com.share.user.domain.UserInfo" resultMap="UserInfoResult">
        <include refid="selectUserInfoVo"/>
        <where>
            <if test="wxOpenId != null and wxOpenId != ''">
                and wx_open_id like concat('%', #{wxOpenId}, '%')
            </if>
            <if test="nickname != null and nickname != ''">
                and nickname like concat('%', #{nickname}, '%')
            </if>
            <if test="phone != null and phone != ''">
                and phone like concat('%', #{phone}, '%')
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="depositStatus != null and depositStatus != ''">
                and deposit_status = #{depositStatus}
            </if>
            <if test="params.beginTime != null and params.beginTime != ''">
                and create_time &gt;= #{params.beginTime}
            </if>
            <if test="params.endTime != null and params.endTime != ''">
                and create_time &lt;= #{params.endTime}
            </if>
        </where>
        order by id desc
    </select>

    <select id="selectUserCount" resultType="com.share.user.domain.UserCountVo">
        SELECT DATE_FORMAT(create_time,'%Y-%m') AS registerDate,
               COUNT(id) AS `count`
        FROM user_info
        WHERE YEAR(create_time)=2024
        GROUP BY DATE_FORMAT(create_time,'%Y-%m')
        ORDER BY registerDate
    </select>
</mapper>
